<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tailwind Table with Pagination</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div
      class="min-h-screen h-full bg-white flex items-center justify-center pt-10 pb-14"
    >
      <div class="w-full max-w-4xl px-2">
        <div>
          <h1 class="text-2xl font-medium">Tailwind Table With Pagination</h1>
        </div>
        <div
          class="w-full overflow-x-scroll md:overflow-auto max-w-7xl 2xl:max-w-none mt-2"
        >
          <table
            class="table-auto overflow-scroll md:overflow-auto w-full text-left font-inter border"
          >
            <thead class="rounded-lg text-base text-white font-semibold w-full">
              <tr class="bg-[#222E3A]/[6%]">
                <th
                  class="py-3 px-3 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Invoice Type
                </th>
                <th
                  class="py-3 px-3 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Policy ID
                </th>
                <th
                  class="py-3 px-3 justify-center gap-1 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Description
                </th>
                <th
                  class="py-3 px-3 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Rate
                </th>
                <th
                  class="py-3 px-3 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Status
                </th>
                <th
                  class="py-3 px-3 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Last Modified
                </th>
                <th
                  class="py-3 px-3 text-[#212B36] sm:text-base font-bold whitespace-nowrap"
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody id="table-body">
              <!-- Rows will be dynamically inserted here -->
            </tbody>
          </table>
        </div>
        <div
          class="w-full flex justify-center sm:justify-between flex-col sm:flex-row gap-5 mt-1.5 px-1 items-center"
        >
          <div class="text-lg" id="entries-info">
            <!-- Entry information will be dynamically updated here -->
          </div>
          <div class="flex">
            <ul
              class="pagination flex justify-center items-center gap-x-[10px] z-30"
              role="navigation"
              aria-label="Pagination"
            >
              <!-- Pagination buttons will be dynamically inserted here -->
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      const rowsLimit = 5;
      let currentPage = 0;
      let totalPage = 0;
      let policies = [];

      function fetchPolicies() {
        $.ajax({
          url: "http://localhost:8080/policy/listpolicy",
          method: "GET",
          success: function (response) {
            if (response.status === 200) {
              policies = response.data;
              totalPage = Math.ceil(policies.length / rowsLimit);
              displayTableData(currentPage);
              updatePagination(totalPage, currentPage);
            } else {
              alert("Failed to fetch data");
            }
          },
          error: function () {
            alert("Error fetching data");
          },
        });
      }

      function displayTableData(page) {
        const startIndex = page * rowsLimit;
        const endIndex = startIndex + rowsLimit;
        const rowsToShow = policies.slice(startIndex, endIndex);

        $("#table-body").empty();
        rowsToShow.forEach((data, index) => {
          $("#table-body").append(`
            <tr class="${index % 2 === 0 ? "bg-white" : "bg-[#222E3A]/[6%]"}">
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">${data.invoiceTypeDTO.name}</td>
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">${data.exchangeRatePolicy.id}</td>
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">${
            data.exchangeRatePolicy.description_policy
          }</td>
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">${data.exchangeRatePolicy.rate}</td>
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">${
            data.exchangeRatePolicy.status ? "Active" : "Inactive"
          }</td>
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">${new Date(
            data.exchangeRatePolicy.lastModified
          ).toLocaleDateString()}</td>
              <td class="py-2 px-3 font-normal text-base border-t ${
                index === 0 ? "border-black" : "border-t"
              } whitespace-nowrap">
                <button class="text-blue-500">Edit</button>
                <button class="text-red-500">Delete</button>
              </td>
            </tr>
          `);
        });

        $("#entries-info").text(
          `Showing ${startIndex + 1} to ${
            endIndex > policies.length ? policies.length : endIndex
          } of ${policies.length} entries`
        );
      }

      function updatePagination(totalPages, currentPage) {
        let pagination = $(".pagination");
        pagination.empty();

        if (currentPage > 0) {
          pagination.append(`
            <li>
              <span
                tabindex="0"
                aria-label="backward"
                role="button"
                class="focus:ring-2 focus:ring-offset-2 focus:ring-indigo-700 p-1 flex rounded transition duration-150 ease-in-out text-base leading-tight font-bold text-gray-500 hover:text-indigo-700 focus:outline-none mr-1 sm:mr-3"
                onclick="fetchPage(${currentPage - 1})"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z"/>
                  <polyline points="15 6 9 12 15 18" />
                </svg>
              </span>
            </li>
          `);
        }

        for (let i = 0; i < totalPages; i++) {
          pagination.append(`
            <li>
              <span
                tabindex="0"
                class="focus:outline-none focus:bg-indigo-700 focus:text-white flex text-indigo-700 dark:text-indigo-400 ${
                  i === currentPage
                    ? "bg-gray-400 text-white"
                    : "bg-white dark:bg-gray-700 hover:bg-indigo-600 hover:text-white"
                } ${
            i < currentPage - 1 || i > currentPage + 1 ? "hidden" : " "
          } text-base leading-tight font-bold cursor-pointer shadow transition duration-150 ease-in-out mx-2 sm:mx-4 rounded px-3 py-2"
                onclick="fetchPage(${i})"
              >
                ${i + 1}
              </span>
            </li>
          `);
        }

        if (currentPage < totalPages - 1) {
          pagination.append(`
            <li>
              <span
                tabindex="0"
                aria-label="forward"
                role="button"
                class="focus:ring-2 focus:ring-offset-2 focus:ring-indigo-700 focus:outline-none flex rounded transition duration-150 ease-in-out text-base leading-tight font-bold text-gray-500 hover:text-indigo-700 p-1 focus:outline-none ml-1 sm:ml-3"
                onclick="fetchPage(${currentPage + 1})"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z"/>
                  <polyline points="9 6 15 12 9 18" />
                </svg>
              </span>
            </li>
          `);
        }
      }

      function fetchPage(page) {
        currentPage = page;
        displayTableData(currentPage);
        updatePagination(totalPage, currentPage);
      }

      // Initial fetch
      fetchPolicies();
    </script>
  </body>
</html>
